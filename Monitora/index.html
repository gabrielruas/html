<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Geolocaliza√ß√£o</title>
<!-- CSS -->
<link rel="stylesheet" href="./css/reset.css">
<link rel="stylesheet" href="./css/header.css">
<link rel="stylesheet" href="./css/main.css">
<link rel="stylesheet" href="./css/footer.css">
<link rel="stylesheet" href="./css/responsive.css">
<!-- ICONS -->
<script src="https://kit.fontawesome.com/f7c21158eb.js" crossorigin="anonymous" defer></script>
<script src="script.js"></script>
<style>
    .form-container {
        display: flex;
        align-items: center;
    }
    .form-container label {
        margin-right: 10px;
    }
    .form-container input,
    .form-container select {
        margin-right: 10px;
    }
</style>
</head>
<body>
<header>
<h1>Sistema de Monitoramneto de Veiculo </h1>
<nav>
<a href="https://github.com/zCHICOz" target="_blank">
<i class="fab fa-github"></i>
</a>
<a href="https://www.especialvcoffee.com.br/" target="_blank">
<i class="fa-solid fa-mug-saucer"></i>
</a>
<a href="https://www.youtube.com/c/DevCHICO" target="_blank">
<i class="fab fa-youtube"></i>
</a>
<a href="https://www.instagram.com/dev.chico/" target="_blank">
<i class="fab fa-instagram"></i>
</a>
</nav>
</header>

<main>
    <figure>
        <img src="./img/gps.png" alt="Imagem de Gabriel Ruas">
        <figcaption>Geolocaliza√ß√£o</figcaption>
    </figure>
    <section class="main-content">
    <article class="text">
    <h2>üë®‚Äçüíª Quem Somos </h2>
    <p>
        Nosso Sistema de Geolocaliza√ß√£o de Ve√≠culos proporciona uma maneira eficiente de monitorar sua frota em tempo real. Com uma interface intuitiva, voc√™ pode visualizar a posi√ß√£o exata de cada ve√≠culo, acompanhar rotas e velocidades, e acessar o hist√≥rico de deslocamentos. Isso facilita a gest√£o e otimiza a efici√™ncia operacional.
    </p>
    <p>
        O sistema permite configurar alertas e notifica√ß√µes personalizados, informando sobre eventos como entrada e sa√≠da de zonas ou excesso de velocidade. A busca por ve√≠culos espec√≠ficos pelo n√∫mero de identifica√ß√£o ou placa √© simples e r√°pida, melhorando a seguran√ßa e o controle da frota.
    </p>
    <p>
        Al√©m disso, oferece gera√ß√£o de relat√≥rios detalhados e personaliz√°veis para obter insights sobre o desempenho dos ve√≠culos. Ajuste as configura√ß√µes conforme suas necessidades e conte com nossa se√ß√£o de suporte para qualquer assist√™ncia. Descubra como nossa solu√ß√£o pode tornar a gest√£o de frota mais inteligente e eficaz.
    </p>
    
    </article>
    <aside class="techs">
    <h2>üë®‚ÄçüíªSelecione seu Relat√≥rio</h2>
    <div class="cards-container">
    
    <div class="cards-container2">
        <!-- Bot√£o para carregar dados do Google Sheets -->
        <button class="card" onclick="loadSheetData()">
            <img src="./img/techs/carrega.png" alt="Logo do frente">
        </button>
        <p>
            Carregar botao acima
        </p>
        
        <!-- Formul√°rio para selecionar o nome do ve√≠culo e a data -->
        <form id="reportForm" onsubmit="handleSubmit(event)">
            <div class="form-container">
                <label for="vehicleName">Nome do Ve√≠culo:</label>
                <select id="vehicleName" name="vehicleName" required>
                    <!-- Op√ß√µes ser√£o preenchidas dinamicamente -->
                </select>
                
                <label for="reportDate">Data:</label>
                <input type="date" id="reportDate" name="reportDate" required>
                
                <button type="button" onclick="searchData()">Pesquisar</button>
            </div>
        </form>
    </div>
         
    </div>
    </aside>
    </section>
</main>
<footer>
    <span>Prefeitura Municipal de Alterosa - Governo de Todos</span>
    <div class="cards-container">
        <div class="card">
        <img src="./img/techs/web-logo.jpg" alt="Logo do WEB">
        </div>
        <div class="card">
        <img src="./img/techs/css-logo.png" alt="Logo do CSS3">
        </div>
        <div class="card">
        <img src="./img/techs/js-logo.png" alt="Logo do Javascript">
        </div>
        <div class="card">
        <img src="./img/techs/react-logo.png" alt="Logo do React">
        </div>
    </div>
</footer>
</body>
</html>

<script>
    function handleSubmit(event) {
        event.preventDefault(); // Previne o comportamento padr√£o do formul√°rio
        const vehicleName = document.getElementById('vehicleName').value;
        const reportDate = document.getElementById('reportDate').value;
        
        // Chama a fun√ß√£o do JavaScript passando os dados do formul√°rio
        funcaoDoJavaScript(vehicleName, reportDate);
    }

    function funcaoDoJavaScript(vehicleName, reportDate) {
        // L√≥gica para processar os dados recebidos
        console.log(`Nome do Ve√≠culo: ${vehicleName}`);
        console.log(`Data do Relat√≥rio: ${reportDate}`);
        // Adicione aqui a l√≥gica necess√°ria para gerar o relat√≥rio
    }
    /////////////////////////////////// select //////////////////////////////////
async function searchData() {
    const vehicleName = document.getElementById('vehicleName').value;
    const reportDate = document.getElementById('reportDate').value;

    if (!vehicleName || !reportDate) {
        alert('Por favor, selecione um nome de ve√≠culo e uma data.');
        return;
    }

    try {
        // Requisi√ß√£o para obter todos os registros
        const response = await fetch('https://script.google.com/macros/s/AKfycbzYvB9zfP9R400y0iiUnhn9Uqx1q-rbZ1EKLkFG1v_hnl-qj5MqxuInU3vPD8LH2Dsk/exec?action=Read');
        const data = await response.json();

        // Log para verificar a estrutura dos dados
        console.log('Dados recebidos:', data);

        // Filtra os dados de acordo com o ve√≠culo e a data selecionados
        const filteredData = data.filter(record => {
            // Verifica se record.date est√° presente e √© uma string v√°lida
            if (record.date && typeof record.date === 'string') {
                try {
                    // Converte a data ISO para o formato YYYY-MM-DD
                    const recordDate = new Date(record.date).toISOString().split('T')[0];
                    return record.nome === vehicleName && recordDate === reportDate;
                } catch (e) {
                    console.error('Erro ao converter a data:', e);
                    return false; // Se houver erro ao converter, exclui o registro
                }
            }
            return false; // Se record.date n√£o estiver presente ou n√£o for uma string v√°lida
        });

        // Log para verificar dados filtrados
        console.log('Dados filtrados:', filteredData);

        // Ajuste conforme o formato dos dados
        const coordinates = filteredData.map(record => ({
            latitude: record.latitude || record.lat,  // Ajuste conforme o nome correto do campo
            longitude: record.longitude || record.lon // Ajuste conforme o nome correto do campo
        }));

        console.log('Coordenadas filtradas:', coordinates);
        
        // Construir a string de coordenadas para o URL
        const coordinatesString = coordinates.map(coord => `${coord.longitude},${coord.latitude}`).join('/');
        console.log('Coordenadas filtradas:', coordinatesString);

        // Construir o URL do Google Maps com as coordenadas filtradas
        const url = `https://www.google.com/maps/dir/${coordinatesString}`;

        // Abrir o URL em uma nova aba
        window.open(url, '_blank');

    } catch (error) {
        console.error('Erro ao buscar dados:', error);
    }
}
////////////////////////////////// fim select //////////////////////////////

    async function loadSheetData() {
        try {
            const response = await fetch('https://script.google.com/macros/s/AKfycbzYvB9zfP9R400y0iiUnhn9Uqx1q-rbZ1EKLkFG1v_hnl-qj5MqxuInU3vPD8LH2Dsk/exec?action=Read');
            const data = await response.json();

            const vehicleSelect = document.getElementById('vehicleName');
            const dateSelect = document.getElementById('reportDate');

            vehicleSelect.innerHTML = ''; // Limpa as op√ß√µes existentes
            dateSelect.innerHTML = ''; // Limpa as op√ß√µes existentes

            const uniqueVehicles = new Set();
            const uniqueDates = new Set();

            data.forEach(record => {
                uniqueVehicles.add(record.nome);
                uniqueDates.add(record.datetime.split(' ')[0]);
            });

            uniqueVehicles.forEach(vehicle => {
                const optionName = document.createElement('option');
                optionName.value = vehicle;
                optionName.text = vehicle;
                vehicleSelect.appendChild(optionName);
            });

            uniqueDates.forEach(date => {
                const optionDate = document.createElement('option');
                optionDate.value = date;
                optionDate.text = date;
                dateSelect.appendChild(optionDate);
            });

        } catch (error) {
            console.error('Erro ao carregar dados da planilha:', error);
        }
    }



</script>
